(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2096],{76086:function(t,e,s){Promise.resolve().then(s.t.bind(s,65878,23)),Promise.resolve().then(s.bind(s,81523)),Promise.resolve().then(s.bind(s,70049)),Promise.resolve().then(s.bind(s,98461))},99376:function(t,e,s){"use strict";var o=s(35475);s.o(o,"usePathname")&&s.d(e,{usePathname:function(){return o.usePathname}}),s.o(o,"useRouter")&&s.d(e,{useRouter:function(){return o.useRouter}}),s.o(o,"useSearchParams")&&s.d(e,{useSearchParams:function(){return o.useSearchParams}}),s.o(o,"useServerInsertedHTML")&&s.d(e,{useServerInsertedHTML:function(){return o.useServerInsertedHTML}})},98461:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return D}});var o=s(57437),i=s(2265),a=s(69340),r=s(78796),l=s(19383),n=s(48860),u=s(34096),d=s(49270),c=s(16152),p=s(20517),_=s(25810),v=s(29501),m=s(71096),h=s.n(m),g=s(80605),f=s(89427),b=s(82645),y=s(99376),x=s(25957),k=s(35586),S=s(2433),Y=s(83930),w=s(48448);function D(){let{data:t}=(0,g.useSession)(),{setDataPost:e,setStatusSave:s}=(0,Y.k)(),[m,D]=i.useState(""),[j,C]=i.useState(!1),[M,I]=i.useState(!1),[P,T]=i.useState(""),[H,q]=i.useState(!1),{isOpen:E,onOpen:N,onClose:z}=(0,a.q)(),{setIsModalMedia:L,isOpenFeatureImage:O,openFeatureImage:W,closeFeatureImage:A,setSeletectedImage:B,closeMedia:F,seletectedImage:Z,focalPoint:R,setGallery:V,closeGallery:U}=(0,x.G)(),G=(0,y.useRouter)(),{register:K,handleSubmit:Q,formState:{errors:J},setValue:X,control:$,trigger:tt,watch:te,reset:ts,getValues:to}=(0,v.cI)({defaultValues:{post_slug:"",post_title:"",post_content:"",post_tag:[],post_category:[],post_publisher:[],feature_img:"",post_status:"draft"}});(0,v.qo)({control:$,name:"post_title"});let ti=(0,r.p)();i.useEffect(()=>{let t=te(()=>{let t=to();I(!!(t.post_title||t.post_content||t.post_tag&&t.post_tag.length>0||t.post_category&&t.post_category.length>0||t.post_publisher&&t.post_publisher.length>0||t.feature_img))}),e=t=>{let{inMediaModal:e,bypassNavCheck:s}=k.b.getState();if(M&&!H&&!s&&!e){t.preventDefault();let e="You have unsaved changes. Are you sure you want to leave?";return t.returnValue=e,e}};window.addEventListener("beforeunload",e);let s=()=>{window.history.pushState({fromForm:!0},"")};s();let o=t=>{let{inMediaModal:e,bypassNavCheck:o}=k.b.getState();!M||H||o||e||(s(),N())};return window.addEventListener("popstate",o),()=>{t.unsubscribe(),window.removeEventListener("beforeunload",e),window.removeEventListener("popstate",o)}},[te,to,M,H,N]),i.useEffect(()=>{let t=G.push.bind(G),e=G.back.bind(G);return G.push=(e,s)=>{let{inMediaModal:o,bypassNavCheck:i}=k.b.getState();return!M||H||i||o?t(e,s):(T(e),N(),Promise.resolve(!1))},G.back=()=>{let{inMediaModal:t,bypassNavCheck:s}=k.b.getState();return!M||H||s||t?e():(N(),Promise.resolve(!1))},()=>{G.push=t,G.back=e}},[G,M,N,H]);let ta=async e=>{var s,o,i,a,r,l,n,u,d,c,p;C(!0),e.post_date=h()().format("YYYY-MM-DD HH:mm:ss"),e.post_publish_date="scheduled"===e.post_status?h()(e.post_publish_date).format("YYYY-MM-DD HH:mm:ss"):null,e.post_original_date=h()().format("YYYY-MM-DD HH:mm:ss"),e.post_status=[e.post_status],e.post_author="".concat(t.user.first_name," ").concat(t.user.last_name),e.post_tag=e.post_tag.map(t=>t.label),e.is_premium=0,e.partner_id=1,e.post_video_url=null!==(o=e.post_video_url)&&void 0!==o?o:"",e.post_gallery=null!==(i=e.post_gallery)&&void 0!==i?i:[],e.post_modified=h()().format("YYYY-MM-DD HH:mm:ss"),e.feat_img_size={small:{x:null==R?void 0:R.x.toString(),y:null==R?void 0:R.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},e.post_editor=0,e.post_source=0,e.post_canonical_link="",e.is_ghost=0,e.post_enclosure_link="",e.post_title_masking="",e.contributor=null!==(a=e.contributor)&&void 0!==a?a:"",e.contributor_id="",e.id=0;let _=await (0,f.Z)("POST","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=0"),e,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.access_token)});(null==_?void 0:_.status)==201?(C(!1),I(!1),q(!0),ti({title:"Success",description:"Data has been saved",status:"success",duration:6e3,isClosable:!0,position:"top"}),setTimeout(()=>{let t="publish"===e.post_status?"/dashboard/post/list":"/dashboard/post/draft";window.history.pushState({bypassCheck:!0},""),G.push(t)},150)):(null==_?void 0:_.status)==403?(C(!1),await (0,w.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=0"),method:"POST",status:_.status,statusText:"Forbidden",requestData:e,responseData:null==_?void 0:_.data,userId:null==t?void 0:null===(l=t.user)||void 0===l?void 0:null===(r=l.userId)||void 0===r?void 0:r.toString(),sessionId:null==t?void 0:null===(n=t.user)||void 0===n?void 0:n.access_token,additionalContext:{action:"create_post",postTitle:e.post_title,postStatus:e.post_status}}),ti({title:"Error",description:null==_?void 0:null===(u=_.data)||void 0===u?void 0:u.message,status:"error",duration:6e3,isClosable:!0,position:"top"})):(C(!1),await (0,w.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=0"),method:"POST",status:(null==_?void 0:_.status)||500,statusText:"Validation Error",requestData:e,responseData:null==_?void 0:_.data,userId:null==t?void 0:null===(c=t.user)||void 0===c?void 0:null===(d=c.userId)||void 0===d?void 0:d.toString(),sessionId:null==t?void 0:null===(p=t.user)||void 0===p?void 0:p.access_token,additionalContext:{action:"create_post",postTitle:e.post_title,postStatus:e.post_status}}),ti({title:"Failed to create data",description:_.data.detail.map(t=>"".concat(t.loc.join(" -> "),": ").concat(t.msg)).join(", "),status:"error",duration:7e3,isClosable:!0,position:"top"}))},tr=async()=>{var e,o,i,a,r,l,n,u,d,c,p,_,v,g,b,y,x,k,S,Y,j;let C=to();s("saving"),C.post_date=h()().format("YYYY-MM-DD HH:mm:ss"),C.post_publish_date="scheduled"===C.post_status?h()(C.post_publish_date).format("YYYY-MM-DD HH:mm:ss"):null,C.post_original_date=h()().format("YYYY-MM-DD HH:mm:ss"),C.post_status=["draft"],C.post_author="".concat(t.user.first_name," ").concat(t.user.last_name),C.post_tag=null!==(i=null===(e=C.post_tag)||void 0===e?void 0:e.map(t=>t.label))&&void 0!==i?i:[],C.is_premium=0,C.partner_id=1,C.post_video_url=null!==(a=C.post_video_url)&&void 0!==a?a:"",C.post_gallery=null!==(r=C.post_gallery)&&void 0!==r?r:[],C.post_modified=h()().format("YYYY-MM-DD HH:mm:ss"),C.feat_img_size={small:{x:null==R?void 0:R.x.toString(),y:null==R?void 0:R.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},C.post_editor=0,C.post_source=0,C.post_canonical_link="",C.is_ghost=0,C.post_enclosure_link="",C.post_title_masking="",C.post_images_title=null!==(l=C.post_images_title)&&void 0!==l?l:"",C.feature_img=null!==(n=C.feature_img)&&void 0!==n?n:"",C.post_publisher=null!==(u=C.post_publisher)&&void 0!==u?u:[],C.post_category=null!==(d=C.post_category)&&void 0!==d?d:[],C.post_category_id=null!==(c=C.post_category_id)&&void 0!==c?c:[],C.contributor=null!==(p=C.contributor)&&void 0!==p?p:"",C.contributor_id="",C.id=0;let M=await (0,f.Z)("POST","".concat("https://mercury.uzone.id/","api/v1/articles/"),C,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(o=t.user)||void 0===o?void 0:o.access_token)});if((null==M?void 0:M.status)==201)s("saved"),D(null==M?void 0:null===(v=M.data)||void 0===v?void 0:null===(_=v.data)||void 0===_?void 0:_.id),I(!1);else{if((null==M?void 0:null===(g=M.data)||void 0===g?void 0:g.message)=="Article with the same slug already exists"){C.id=m;let e=await (0,f.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(m),C,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(b=t.user)||void 0===b?void 0:b.access_token)});(null==e?void 0:e.status)!==200&&await (0,w.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(m),method:"PUT",status:(null==e?void 0:e.status)||500,statusText:"Update Draft Error",requestData:C,responseData:null==e?void 0:e.data,userId:null==t?void 0:null===(x=t.user)||void 0===x?void 0:null===(y=x.userId)||void 0===y?void 0:y.toString(),sessionId:null==t?void 0:null===(k=t.user)||void 0===k?void 0:k.access_token,additionalContext:{action:"update_draft",postTitle:C.post_title,articleId:m}}),I(!1)}else await (0,w.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/"),method:"POST",status:(null==M?void 0:M.status)||500,statusText:"Draft Creation Error",requestData:C,responseData:null==M?void 0:M.data,userId:null==t?void 0:null===(Y=t.user)||void 0===Y?void 0:null===(S=Y.userId)||void 0===S?void 0:S.toString(),sessionId:null==t?void 0:null===(j=t.user)||void 0===j?void 0:j.access_token,additionalContext:{action:"create_draft",postTitle:C.post_title}});s("saved")}};K("post_content",{required:"Content is required"}),K("post_tag",{required:"Tag is required"}),K("post_category",{required:"Category is required"}),K("post_publisher",{required:"publish on is required"}),K("feature_img",{required:"main image is required"});let tl=i.useRef(!1);return i.useEffect(()=>(tl.current||(tl.current=!0,(async()=>{A(),B(""),F(),ts({post_slug:"",post_title:"",post_content:"",post_tag:[],post_category:[],post_publisher:[],feature_img:"",post_status:"draft"}),e(""),V([]),U(),I(!1)})()),()=>{tl.current=!1}),[]),i.useEffect(()=>()=>{ts({post_slug:"",post_title:"",post_content:"",post_tag:[],post_category:[],post_publisher:[],feature_img:"",post_status:"draft"})},[]),(0,o.jsxs)("div",{className:"px-4 pt-6",children:[(0,o.jsx)(b.Z,{register:K,isOpen:O,onClose:A,setValue:X}),(0,o.jsxs)(l.u_,{isOpen:E,onClose:z,isCentered:!0,children:[(0,o.jsx)(n.Z,{}),(0,o.jsxs)(u.h,{children:[(0,o.jsx)(d.x,{children:"Unsaved Changes"}),(0,o.jsx)(c.f,{children:"You have unsaved changes. Are you sure you want to leave this page? Your changes will be lost."}),(0,o.jsxs)(p.m,{children:[(0,o.jsx)(_.z,{colorScheme:"blue",mr:3,onClick:z,children:"Stay on Page"}),(0,o.jsx)(_.z,{variant:"ghost",onClick:()=>{I(!1),q(!0),z(),setTimeout(()=>{P?G.push(P):window.history.back()},50)},children:"Leave Page"})]})]})]}),(0,o.jsx)("div",{className:"flex items-center mb-4 lg:mb-0",children:(0,o.jsx)("h3",{className:"mb-2 text-xl font-bold text-gray-900 dark:text-white",children:"New Post"})}),(0,o.jsx)("div",{className:"",children:(0,o.jsx)("form",{onSubmit:Q(ta),autoComplete:"off",className:"grid grid-cols-1 gap-2 lg:grid-cols-3",children:(0,o.jsx)(S.Z,{register:K,errors:J,session:t,control:$,trigger:tt,setValue:X,isLoading:j,setIsModalMedia:L,openFeatureImage:W,seletectedImage:Z,Controller:v.Qr,watch:te,useFieldArray:v.Dq,saveContentToDraft:tr,isEdit:!1})})})]})}},93088:function(t,e,s){"use strict";s.d(e,{K:function(){return d}});var o=s(41531),i=s(57437),a=t=>(0,i.jsx)(o.m.div,{className:"chakra-stack__item",...t,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...t.__css}});a.displayName="StackItem";var r=s(14096);Object.freeze(["base","sm","md","lg","xl","2xl"]);var l=s(1219),n=s(68973),u=s(2265),d=(0,n.G)((t,e)=>{let{isInline:s,direction:n,align:d,justify:c,spacing:p="0.5rem",wrap:_,children:v,divider:m,className:h,shouldWrapChildren:g,...f}=t,b=s?"row":null!=n?n:"column",y=(0,u.useMemo)(()=>(function(t){var e;let{spacing:s,direction:o}=t,i={column:{my:s,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:s,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:s,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:s,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":(e=t=>i[t],Array.isArray(o)?o.map(t=>null===t?null:e(t)):(0,r.Kn)(o)?Object.keys(o).reduce((t,s)=>(t[s]=e(o[s]),t),{}):null!=o?e(o):null)}})({spacing:p,direction:b}),[p,b]),x=!!m,k=!g&&!x,S=(0,u.useMemo)(()=>{let t=(0,l.W)(v);return k?t:t.map((e,s)=>{let o=void 0!==e.key?e.key:s,r=s+1===t.length,l=(0,i.jsx)(a,{children:e},o),n=g?l:e;if(!x)return n;let d=(0,u.cloneElement)(m,{__css:y});return(0,i.jsxs)(u.Fragment,{children:[n,r?null:d]},o)})},[m,y,x,k,g,v]),Y=(0,r.cx)("chakra-stack",h);return(0,i.jsx)(o.m.div,{ref:e,display:"flex",alignItems:d,justifyContent:c,flexDirection:b,flexWrap:_,gap:x?void 0:p,className:Y,...f,children:S})});d.displayName="Stack"}},function(t){t.O(0,[4565,7360,7699,1544,6051,5706,9956,1779,7240,296,9439,5878,6795,605,1760,9799,3464,9501,6448,9395,9614,7754,7796,8190,821,9305,2971,2117,1744],function(){return t(t.s=76086)}),_N_E=t.O()}]);