(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[898],{42480:function(){},5129:function(t,e,o){Promise.resolve().then(o.t.bind(o,65878,23)),Promise.resolve().then(o.bind(o,81523)),Promise.resolve().then(o.bind(o,70049)),Promise.resolve().then(o.bind(o,41180))},41180:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return k}});var s=o(57437),i=o(2265),a=o(78796),l=o(61507),r=o(6314),n=o(32817),d=o(34442),u=o(25810),c=o(307),p=o(29501),_=o(71096),v=o.n(_),m=o(80605),h=o(89427),g=o(82645),f=o(99376),b=o(25957),x=o(2433),y=o(43118),S=o(83930),j=o(48448);function k(){let{data:t}=(0,m.useSession)(),[e,o]=i.useState(!1),[_,k]=i.useState(!1),[C,I]=i.useState(!1),[z,E]=i.useState(),{dataPost:D,setDataPost:T,setStatusSave:w}=(0,S.k)(),{setIsModalMedia:Y,isOpenFeatureImage:q,openFeatureImage:P,closeFeatureImage:A,setSeletectedImage:M,closeMedia:N,seletectedImage:H,setFocalPoint:U,focalPoint:F,setGallery:Z}=(0,b.G)(),B=(0,f.useRouter)(),{register:G,handleSubmit:O,formState:{errors:R},setValue:V,control:L,trigger:Q,reset:X,watch:J,getValues:K}=(0,p.cI)(),W=(0,a.p)(),$=(0,f.useSearchParams)(),tt=(0,y.A)($.get("aa"))||"",te=async e=>{var s,i,a,l,r,n,d,u,c,p,_,m;o(!0),e.post_date=null==D?void 0:D.post_date,e.post_publish_date="scheduled"===e.post_status?v()(e.post_publish_date).format("YYYY-MM-DD HH:mm:ss"):null==D?void 0:D.post_publish_date,e.post_original_date=null==D?void 0:D.post_original_date,e.post_status=[e.post_status],e.post_author=null==D?void 0:D.post_author,e.post_tag=e.post_tag.map(t=>t.label),e.is_premium=0,e.partner_id=1,e.post_video_url=e.post_video_url||"",e.post_gallery=e.post_gallery||[],e.post_modified=v()().format("YYYY-MM-DD HH:mm:ss"),e.feat_img_size={small:{x:null==F?void 0:F.x.toString(),y:null==F?void 0:F.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},e.post_editor=null==D?void 0:D.post_editor,e.post_source=0,e.post_canonical_link="",e.is_ghost=0,e.post_enclosure_link="",e.post_title_masking="",e.contributor=e.contributor||"",e.contributor_id="";let g=await (0,h.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(tt),e,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.access_token)});if((null==g?void 0:g.status)==200){let s=await (0,h.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/close-editor"),{article_id:tt},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(i=t.user)||void 0===i?void 0:i.access_token)});(null==s?void 0:s.status)!==200&&await (0,j.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/close-editor"),method:"GET",status:(null==s?void 0:s.status)||500,statusText:"Close Editor Error",requestData:{article_id:tt},responseData:null==s?void 0:s.data,userId:null==t?void 0:null===(l=t.user)||void 0===l?void 0:null===(a=l.userId)||void 0===a?void 0:a.toString(),sessionId:null==t?void 0:null===(r=t.user)||void 0===r?void 0:r.access_token,additionalContext:{action:"close_editor",articleId:tt}}),o(!1),W({title:"Success",description:"Data has been updated",status:"success",duration:6e3,isClosable:!0,position:"top"}),"publish"==e.post_status?B.push("/dashboard/post/list"):B.push("/dashboard/post/draft")}else(null==g?void 0:g.status)==403?(o(!1),await (0,j.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(tt),method:"PUT",status:g.status,statusText:"Forbidden",requestData:e,responseData:null==g?void 0:g.data,userId:null==t?void 0:null===(d=t.user)||void 0===d?void 0:null===(n=d.userId)||void 0===n?void 0:n.toString(),sessionId:null==t?void 0:null===(u=t.user)||void 0===u?void 0:u.access_token,additionalContext:{action:"edit_post",articleId:tt,postTitle:e.post_title,postStatus:e.post_status}}),W({title:"Error",description:null==g?void 0:null===(c=g.data)||void 0===c?void 0:c.message,status:"error",duration:6e3,isClosable:!0,position:"top"})):(o(!1),await (0,j.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(tt),method:"PUT",status:(null==g?void 0:g.status)||500,statusText:"Validation Error",requestData:e,responseData:null==g?void 0:g.data,userId:null==t?void 0:null===(_=t.user)||void 0===_?void 0:null===(p=_.userId)||void 0===p?void 0:p.toString(),sessionId:null==t?void 0:null===(m=t.user)||void 0===m?void 0:m.access_token,additionalContext:{action:"edit_post",articleId:tt,postTitle:e.post_title,postStatus:e.post_status}}),W({title:"Failed to create data",description:g.data.detail.map(t=>"".concat(t.loc.join(" -> "),": ").concat(t.msg)).join(", "),status:"error",duration:7e3,isClosable:!0,position:"top"}))},to=async()=>{var e,o,s,i,a;let l=K();w("saving"),l.post_date=null==D?void 0:D.post_date,l.post_publish_date="scheduled"===l.post_status?v()(l.post_publish_date).format("YYYY-MM-DD HH:mm:ss"):null==D?void 0:D.post_publish_date,l.post_original_date=null==D?void 0:D.post_original_date,l.post_status=["draft"],l.post_author="".concat(t.user.first_name," ").concat(t.user.last_name),l.post_tag=(null===(e=l.post_tag)||void 0===e?void 0:e.map(t=>t.label))||[],l.is_premium=0,l.partner_id=1,l.post_video_url=l.post_video_url||"",l.post_gallery=l.post_gallery||[],l.post_modified=v()().format("YYYY-MM-DD HH:mm:ss"),l.feat_img_size={small:{x:null==F?void 0:F.x.toString(),y:null==F?void 0:F.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},l.post_editor=0,l.post_source=0,l.post_canonical_link="",l.is_ghost=0,l.post_enclosure_link="",l.post_title_masking="",l.post_images_title=l.post_images_title||"",l.feature_img=l.feature_img||"",l.contributor=l.contributor||"",l.contributor_id="";let r=await (0,h.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(D.id),l,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(o=t.user)||void 0===o?void 0:o.access_token)});(null==r?void 0:r.status)!==200&&await (0,j.v)({url:"".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(D.id),method:"PUT",status:(null==r?void 0:r.status)||500,statusText:"Draft Save Error",requestData:l,responseData:null==r?void 0:r.data,userId:null==t?void 0:null===(i=t.user)||void 0===i?void 0:null===(s=i.userId)||void 0===s?void 0:s.toString(),sessionId:null==t?void 0:null===(a=t.user)||void 0===a?void 0:a.access_token,additionalContext:{action:"save_draft",articleId:D.id,postTitle:l.post_title}}),w("saved")};G("post_content",{required:"Content is required"}),G("post_tag",{required:"Tag is required"}),G("post_category",{required:"Category is required"}),G("post_publisher",{required:"publish on is required"}),i.useEffect(()=>{let e=async()=>{var e,o,s;let i=await (0,h.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/"),{id:tt},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.access_token)});if((null==i?void 0:i.status)==200){let t=null==i?void 0:null===(o=i.data)||void 0===o?void 0:o.data;t.post_publisher=Array.isArray(t.post_publisher)?[...t.post_publisher,"1"]:["1"],M(null==t?void 0:t.feature_img),U(null==t?void 0:null===(s=t.feat_img_size)||void 0===s?void 0:s.small),Z(null==t?void 0:t.post_gallery),T(t),X(t)}else(null==i?void 0:i.status)==400&&(k(!0),E(null==i?void 0:i.data))};t&&e()},[t]),i.useEffect(()=>(A(),N(),()=>{w("")}),[]);let ts=async()=>{try{var e;I(!0);let o=await (0,h.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/close-editor"),{article_id:tt},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.access_token)});(null==o?void 0:o.status)==200&&(window.history.length>1?B.back():B.push("/dashboard/post/list"))}catch(t){I(!1),W({title:"Error",description:"Failed to cancel edit. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top"})}};return(0,s.jsxs)("div",{className:"px-4 pt-6",children:[(0,s.jsx)(g.Z,{register:G,isOpen:q,onClose:A,setValue:V}),_?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l.b,{status:"error",children:[(0,s.jsx)(r.z,{}),(0,s.jsx)(n.C,{children:"Info"}),(0,s.jsx)(d.X,{children:null==z?void 0:z.message})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(u.z,{mt:5,colorScheme:"teal",onClick:()=>B.back(),children:"Back"})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4 lg:mb-2",children:[(0,s.jsx)("h3",{className:"mb-2 text-xl font-bold text-gray-900 dark:text-white",children:"Edit Post"}),(0,s.jsx)(u.z,{colorScheme:"red",onClick:ts,isLoading:C,loadingText:"Canceling",children:"Cancel Edit"})]}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)("form",{onSubmit:O(te),autoComplete:"off",className:"grid grid-cols-1 gap-2 lg:grid-cols-3",children:D?(0,s.jsx)(x.Z,{register:G,errors:R,session:t,control:L,trigger:Q,setValue:V,isLoading:e,setIsModalMedia:Y,openFeatureImage:P,seletectedImage:H,Controller:p.Qr,watch:J,useFieldArray:p.Dq,saveContentToDraft:to,isEdit:!0}):(0,s.jsx)(c.E,{size:"xs",className:"lg:col-span-3",isIndeterminate:!0})})})]})]})}},43118:function(t,e,o){"use strict";o.d(e,{A:function(){return l},P:function(){return a}});var s=o(80928),i=o.n(s);function a(t){return encodeURIComponent(i().AES.encrypt(t.toString(),"c2c9cfa669c5a7fd065c694e3c112f1aec09401e895ad77f72255158b9847d58").toString())}function l(t){return i().AES.decrypt(decodeURIComponent(t),"c2c9cfa669c5a7fd065c694e3c112f1aec09401e895ad77f72255158b9847d58").toString(i().enc.Utf8)}}},function(t){t.O(0,[4565,7360,7699,1544,6051,5706,9956,1779,7240,296,9439,5878,6795,605,1760,9799,3464,9501,9611,6448,9395,9614,7754,7796,1523,821,9305,2971,2117,1744],function(){return t(t.s=5129)}),_N_E=t.O()}]);