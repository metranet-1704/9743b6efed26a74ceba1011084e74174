(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3187],{50255:function(e,t,r){Promise.resolve().then(r.bind(r,97490))},99376:function(e,t,r){"use strict";var s=r(35475);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}}),r.o(s,"useServerInsertedHTML")&&r.d(t,{useServerInsertedHTML:function(){return s.useServerInsertedHTML}})},97490:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var s=r(57437),a=r(2265),n=r(80605),i=r(99376),l=r(71594),o=r(24525),c=r(28082),d=r(307),u=r(49089),m=r(89427),g=r(71096),x=r.n(g),h=r(25103),p=r.n(h);function f(e){let{search:t,startDate:r,endDate:i,isUpdate:g,setIsUpdate:h}=e,[f,v]=a.useState([]),[y,j]=a.useState(!1),[b,N]=a.useState([]),[w,S]=a.useState({pageIndex:0,pageSize:10}),[k,O]=a.useState(0),[C,P]=a.useState(0),{data:_}=(0,n.useSession)(),E=(0,l.b7)({data:f,columns:[{accessorKey:"timestamps",header:e=>{let{column:t}=e,r=t.getIsSorted();return(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>t.toggleSorting(),children:[(0,s.jsx)("span",{children:"Timestamp"}),"asc"===r?(0,s.jsx)(u.h3_,{className:"ml-2"}):"desc"===r?(0,s.jsx)(u.sF,{className:"ml-2"}):(0,s.jsx)(u.roE,{className:"ml-2"})]})},cell:e=>{let{row:t}=e;return(0,s.jsxs)("div",{className:"min-w-[150px]",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:x()(t.original.timestamps).format("DD MMM YYYY")}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:x()(t.original.timestamps).format("HH:mm:ss")})]})}},{accessorKey:"username",header:e=>{let{column:t}=e,r=t.getIsSorted();return(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>t.toggleSorting(),children:[(0,s.jsx)("span",{children:"Username"}),"asc"===r?(0,s.jsx)(u.h3_,{className:"ml-2"}):"desc"===r?(0,s.jsx)(u.sF,{className:"ml-2"}):(0,s.jsx)(u.roE,{className:"ml-2"})]})},cell:e=>{let{row:t}=e;return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white break-words",children:(t.original.username||"Unknown").replace(/@metranet\.co\.id$/,"")})})}},{accessorKey:"request.method",header:e=>{let{column:t}=e,r=t.getIsSorted();return(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",onClick:()=>t.toggleSorting(),children:[(0,s.jsx)("span",{children:"Method"}),"asc"===r?(0,s.jsx)(u.h3_,{className:"ml-2"}):"desc"===r?(0,s.jsx)(u.sF,{className:"ml-2"}):(0,s.jsx)(u.roE,{className:"ml-2"})]})},cell:e=>{let{row:t}=e;return(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(c.Vp,{size:"sm",colorScheme:"GET"===t.original.request.method?"blue":"POST"===t.original.request.method?"green":"PUT"===t.original.request.method?"orange":"DELETE"===t.original.request.method?"red":"gray",children:t.original.request.method})})}},{accessorKey:"request.client_ip",header:"IP Address",cell:e=>{let{row:t}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:t.original.request.client_ip}),t.original.network.forwarded_for&&(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Forwarded: ",t.original.network.forwarded_for]})]})}},{accessorKey:"device",header:"Device Info",cell:e=>{let{row:t}=e;return(0,s.jsxs)("div",{className:"max-w-xs",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white break-words",children:t.original.device.browser_family||"Other"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 break-words",children:[t.original.device.os_family||"Other","True"===t.original.device.is_mobile&&(0,s.jsx)(c.Vp,{size:"xs",colorScheme:"blue",ml:1,children:"Mobile"}),"True"===t.original.device.is_bot&&(0,s.jsx)(c.Vp,{size:"xs",colorScheme:"orange",ml:1,children:"Bot"})]})]})}},{accessorKey:"request.client_ip",header:"IP Address",cell:e=>{let{row:t}=e;return(0,s.jsxs)("div",{className:"max-w-xs",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white break-words",children:t.original.request.client_ip}),(!0===t.original.request.secure_connection||"True"===t.original.request.secure_connection)&&(0,s.jsx)(c.Vp,{size:"xs",colorScheme:"green",mt:1,children:"HTTPS"}),(0,s.jsx)("div",{className:"text-sm text-gray-500 break-words",children:t.original.network.host||"Unknown"})]})}}],getCoreRowModel:(0,o.sC)(),onSortingChange:N,state:{sorting:b},manualSorting:!0,manualPagination:!0}),I=a.useCallback(async()=>{if(null==_?void 0:_.user){j(!0);try{let e=new URLSearchParams({page:(w.pageIndex+1).toString(),limit:w.pageSize.toString()});if(t&&e.append("search",t),r&&e.append("startDate",r.toISOString()),i&&e.append("endDate",i.toISOString()),b.length>0){let t=b[0];e.append("sortField","timestamps"===t.id?"timestamps":t.id),e.append("sortOrder",t.desc?"desc":"asc")}let s=await (0,m.Z)("GET","/api/logs/users?".concat(e.toString()),{},{});if(200===s.status){let e=s.data;v(e.data||[]),O(e.totalPages||0),P(e.total||0)}else console.error("Failed to fetch user logs:",s.data),v([])}catch(e){console.error("Error fetching user logs:",e),v([])}finally{j(!1)}}},[_,t,r,i,w,b]);return a.useEffect(()=>{I()},[I,g]),(0,s.jsxs)("div",{className:"overflow-x-auto",children:[y&&(0,s.jsx)(d.E,{size:"xs",isIndeterminate:!0,colorScheme:"blue",mb:4}),(0,s.jsxs)("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:["Showing ",f.length," of ",C," user logs"]}),(0,s.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:E.getHeaderGroups().map(e=>(0,s.jsx)("tr",{children:e.headers.map(e=>(0,s.jsx)("th",{className:"px-6 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",children:e.isPlaceholder?null:"function"==typeof e.column.columnDef.header?e.column.columnDef.header(e.getContext()):e.column.columnDef.header},e.id))},e.id))}),(0,s.jsx)("tbody",{children:E.getRowModel().rows.map(e=>(0,s.jsx)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:e.getVisibleCells().map(e=>(0,s.jsx)("td",{className:"px-6 py-4",children:"function"==typeof e.column.columnDef.cell?e.column.columnDef.cell(e.getContext()):e.getValue()},e.id))},e.id))})]}),0===f.length&&!y&&(0,s.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No user logs found"}),k>1&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(p(),{breakLabel:"...",nextLabel:"Next",onPageChange:e=>{S(t=>({...t,pageIndex:e.selected}))},pageRangeDisplayed:5,pageCount:k,previousLabel:"Previous",renderOnZeroPageCount:null,className:"flex justify-center items-center space-x-2",pageClassName:"px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",activeClassName:"bg-blue-500 text-white",previousClassName:"px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",nextClassName:"px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",disabledClassName:"opacity-50 cursor-not-allowed",forcePage:w.pageIndex})})]})}var v=r(12125),y=r(10883),j=r(68193),b=r(25810),N=r(85994),w=r.n(N);function S(){let[e,t]=a.useState(0),[r,n]=a.useState(""),[i,l]=a.useState([x()().subtract(7,"day").startOf("day").toDate(),x()().toDate()]),[o,c]=i;return(0,s.jsxs)("div",{className:"px-4 pt-6",children:[(0,s.jsxs)("div",{className:"grid items-center justify-between grid-cols-2",children:[(0,s.jsx)("div",{className:"flex items-center mb-4 lg:mb-0",children:(0,s.jsx)("h3",{className:"mb-2 text-xl font-bold text-gray-900 dark:text-white",children:"User Login Logs"})}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("div",{className:"m-2",children:(0,s.jsx)("div",{className:"max-w-md mx-auto",children:(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)(v.B,{size:"md",children:[(0,s.jsx)(y.I,{pr:"4.5rem",type:"text",placeholder:"search username, IP...",className:"bg-white dark:bg-gray-700",onKeyDown:e=>"Enter"===e.key&&n(e.target.value)}),(0,s.jsx)(j.x,{children:(0,s.jsx)(b.z,{size:"sm",children:(0,s.jsx)(u.U41,{})})})]})})})})})]}),(0,s.jsxs)("div",{className:"p-4 bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800",children:[(0,s.jsxs)("div",{className:"items-center justify-between lg:flex",children:[(0,s.jsx)("div",{className:"flex items-center mb-4 lg:mb-0"}),(0,s.jsx)("div",{className:"items-center sm:flex",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center mb-3 space-x-0 space-y-2 md:space-x-2 md:space-y-0",children:[(0,s.jsx)(w(),{className:"bg-white dark:bg-gray-800 !p-[.3rem] !text-sm !w-[200px]",selectsRange:!0,startDate:o,endDate:c,dateFormat:"dd-MM-yyyy",onChange:e=>{l(e)},isClearable:!0}),(0,s.jsx)("div",{className:"w-full md:w-auto",children:(0,s.jsx)(b.z,{colorScheme:"blue",size:"sm",className:"w-full md:w-auto",onClick:()=>t(Math.floor(1e4*Math.random())),children:"Filter"})})]})})})]}),(0,s.jsx)(f,{search:r,startDate:o,endDate:c,isUpdate:e,setIsUpdate:t})]})]})}function k(){var e;let{data:t,status:r}=(0,n.useSession)(),l=(0,i.useRouter)();return(a.useEffect(()=>{var e;if("loading"!==r){if(!t){l.push("/login");return}if((null===(e=t.user)||void 0===e?void 0:e.privilege_id)!==1){l.push("/dashboard");return}}},[t,r,l]),"loading"===r)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Loading..."})}):t&&(null===(e=t.user)||void 0===e?void 0:e.privilege_id)===1?(0,s.jsx)("div",{children:(0,s.jsx)(S,{})}):null}r(21005)},89427:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(83464);async function a(e,t,r,a){try{let n;let i={"User-Agent":"UZone-CMS-Client/1.0 (+https://uzone.id)",...a};return a&&(a["User-Agent"]||a["user-agent"])&&(delete i["User-Agent"],i["User-Agent"]=a["User-Agent"]||a["user-agent"]),n="GET"==e?{validateStatus:()=>!1,method:e,headers:i,url:t,params:r}:{validateStatus:()=>!1,method:e,headers:i,url:t,data:r},await (0,s.Z)(n).catch(e=>e.response)}catch(e){return{data:e,status:500,statusText:"Internal Server Error",headers:{},config:{}}}}},13856:function(e,t,r){"use strict";r.d(t,{J:function(){return c}});var s=r(68973),a=r(9889),n=r(41531),i=r(14096),l=r(57437),o={path:(0,l.jsxs)("g",{stroke:"currentColor",strokeWidth:"1.5",children:[(0,l.jsx)("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),(0,l.jsx)("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),(0,l.jsx)("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},c=(0,s.G)((e,t)=>{let{as:r,viewBox:s,color:c="currentColor",focusable:d=!1,children:u,className:m,__css:g,...x}=e,h=(0,i.cx)("chakra-icon",m),p=(0,a.mq)("Icon",e),f={ref:t,focusable:d,className:h,__css:{w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:c,...g,...p}},v=null!=s?s:o.viewBox;if(r&&"string"!=typeof r)return(0,l.jsx)(n.m.svg,{as:r,...f,...x});let y=null!=u?u:o.path;return(0,l.jsx)(n.m.svg,{verticalAlign:"middle",viewBox:v,...f,...x,children:y})});c.displayName="Icon"},66835:function(e,t,r){"use strict";function s(e){let t=Object.assign({},e);for(let e in t)void 0===t[e]&&delete t[e];return t}r.d(t,{o:function(){return s}})},28082:function(e,t,r){"use strict";r.d(t,{SD:function(){return h},Sn:function(){return g},Vp:function(){return m}});var s=r(13856),a=r(37371),n=r(68973),i=r(9889),l=r(83707),o=r(41531),c=r(57437),[d,u]=(0,a.k)({name:"TagStylesContext",errorMessage:"useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<Tag />\" "}),m=(0,n.G)((e,t)=>{let r=(0,i.jC)("Tag",e),s=(0,l.Lr)(e),a={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...r.container};return(0,c.jsx)(d,{value:r,children:(0,c.jsx)(o.m.span,{ref:t,...s,__css:a})})});m.displayName="Tag";var g=(0,n.G)((e,t)=>{let r=u();return(0,c.jsx)(o.m.span,{ref:t,noOfLines:1,...e,__css:r.label})});g.displayName="TagLabel",(0,n.G)((e,t)=>(0,c.jsx)(s.J,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...e})).displayName="TagLeftIcon",(0,n.G)((e,t)=>(0,c.jsx)(s.J,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...e})).displayName="TagRightIcon";var x=e=>(0,c.jsx)(s.J,{verticalAlign:"inherit",viewBox:"0 0 512 512",...e,children:(0,c.jsx)("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});x.displayName="TagCloseIcon";var h=(0,n.G)((e,t)=>{let{isDisabled:r,children:s,...a}=e,n={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...u().closeButton};return(0,c.jsx)(o.m.button,{ref:t,"aria-label":"close",...a,type:"button",disabled:r,__css:n,children:s||(0,c.jsx)(x,{})})});h.displayName="TagCloseButton"},46231:function(e,t,r){"use strict";r.d(t,{w_:function(){return d}});var s=r(2265),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},n=s.createContext&&s.createContext(a),i=["attr","size","title"];function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){var s,a;s=t,a=r[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(s))in e?Object.defineProperty(e,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[s]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e){return t=>s.createElement(u,l({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,r)=>s.createElement(t.tag,c({key:r},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var r,{attr:a,size:n,title:o}=e,d=function(e,t){if(null==e)return{};var r,s,a=function(e,t){if(null==e)return{};var r={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;r[s]=e[s]}return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,i),u=n||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),s.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,d,{className:r,style:c(c({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),o&&s.createElement("title",null,o),e.children)};return void 0!==n?s.createElement(n.Consumer,null,e=>t(e)):t(a)}}},function(e){e.O(0,[7360,7699,1544,9439,2434,3314,4959,9614,2971,2117,1744],function(){return e(e.s=50255)}),_N_E=e.O()}]);